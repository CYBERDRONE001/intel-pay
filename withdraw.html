<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Withdraw Funds â€“ IntelPay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script>
    (function() {
      emailjs.init("yBlAJJLYdBASSoVK8"); // ğŸ” Replace this
    })();
  </script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4">

  <div class="max-w-lg mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold mb-4 text-center">ğŸ’¸ Withdraw Request</h2>

    <form id="withdrawForm" class="space-y-4">
      <input type="text" id="name" placeholder="Your Full Name" required class="w-full p-3 rounded bg-gray-700 text-white" />
      <input type="text" id="bank" placeholder="Bank Name" required class="w-full p-3 rounded bg-gray-700 text-white" />
      <input type="text" id="account" placeholder="Account Number" required class="w-full p-3 rounded bg-gray-700 text-white" />
      <input type="number" id="amount" placeholder="Amount to Withdraw (Max â‚¦5500)" max="5500" required class="w-full p-3 rounded bg-gray-700 text-white" />
      <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 p-3 rounded font-bold">Request Withdrawal</button>
    </form>

    <p id="statusMsg" class="mt-4 text-center text-sm"></p>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDGdIsemWvuUTe7Df6iOK7suxMRC8G0vNg",
      authDomain: "intel-pay-ltd.firebaseapp.com",
      projectId: "intel-pay-ltd",
      storageBucket: "intel-pay-ltd.appspot.com",
      messagingSenderId: "779411397815",
      appId: "1:779411397815:web:7b6d9f34572d13a833c132"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const form = document.getElementById("withdrawForm");
    const statusMsg = document.getElementById("statusMsg");

    auth.onAuthStateChanged((user) => {
      if (!user) {
        alert("You must be logged in to withdraw.");
        window.location.href = "login.html";
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value;
        const bank = document.getElementById("bank").value;
        const account = document.getElementById("account").value;
        const amount = parseFloat(document.getElementById("amount").value);

        if (amount > 5500) {
          alert("âŒ You can only withdraw up to â‚¦5500.");
          return;
        }

        // Save to Firestore
        await db.collection("withdrawals").add({
          uid: user.uid,
          email: user.email,
          name,
          bank,
          account,
          amount,
          status: "pending",
          requestedAt: Date.now()
        });

        // Send EmailJS notification
        emailjs.send("service_h46ycvt", "template_ezkjhnj", {
          user_email: user.email,
          user_name: name,
          bank_name: bank,
          account_number: account,
          amount: amount
        })
        .then(() => {
          statusMsg.innerText = "âœ… Withdrawal submitted & admin notified!";
        })
        .catch((error) => {
          console.error("EmailJS error:", error);
          statusMsg.innerText = "âš ï¸ Submitted but failed to email admin.";
        });

        form.reset();
      });
    });
  </script>
</body>
</html>