<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard – IntelPay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">

<!-- Top Navigation -->
<nav class="bg-gray-800 w-full fixed top-0 z-50 shadow-md">
  <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
    <h1 class="text-white text-lg font-bold">💰 IntelPay</h1>
    <div class="space-x-4 hidden md:flex">
      <a href="dashboard.html" class="text-white hover:text-blue-400">Dashboard</a>
      <a href="pay.html" class="text-white hover:text-blue-400">Pay</a>
      <a href="invite.html" class="text-white hover:text-blue-400">Invite</a>
      <a href="support.html" class="text-white hover:text-blue-400">Support</a>
    </div>
    <button onclick="document.getElementById('mobileNav').classList.toggle('hidden')" class="md:hidden text-white">
      ☰
    </button>
  </div>
</nav>

<div id="mobileNav" class="bg-gray-800 mt-14 w-full text-center py-2 space-y-2 md:hidden hidden fixed z-40">
  <a href="dashboard.html" class="block text-white hover:text-blue-400">Dashboard</a>
  <a href="pay.html" class="block text-white hover:text-blue-400">Pay</a>
  <a href="invite.html" class="block text-white hover:text-blue-400">Invite</a>
  <a href="support.html" class="block text-white hover:text-blue-400">Support</a>
</div>
<div class="pt-24"></div>

<!-- Page Layout -->
<div class="flex min-h-screen">
  <!-- Sidebar -->
  <aside class="w-64 bg-gray-800 hidden md:block p-4 space-y-4 fixed h-full">
    <h2 class="text-xl font-bold mb-4">🧭 Navigation</h2>
    <nav class="flex flex-col space-y-2">
      <a href="dashboard.html" class="hover:text-blue-400">🏠 Dashboard</a>
      <a href="withdraw.html" class="hover:text-blue-400">💸 Withdraw</a>
      <a href="invite.html" class="hover:text-blue-400">🎁 Referral</a>
      <a href="pay.html" class="hover:text-blue-400">💳 Make Payment</a>
      <a href="support.html" class="hover:text-blue-400">🤖 Support</a>
    </nav>
  </aside>

  <!-- Dashboard -->
  <main class="flex-1 ml-0 md:ml-64 p-6">
    <h1 class="text-2xl font-bold mb-4">🎉 Welcome Back</h1>

    <div class="bg-gray-800 p-6 rounded-lg mb-6">
      <p class="text-lg">Your Earnings:</p>
      <h2 id="earnings" class="text-3xl font-bold text-green-400">₦0</h2>
      <p class="text-sm text-gray-400 mt-2" id="statusText">Checking payment status...</p>
    </div>

    <button onclick="logout()" class="bg-red-500 px-4 py-2 rounded hover:bg-red-600">Logout</button>
  </main>
</div>

<!-- Firebase Scripts -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import {
    getAuth, onAuthStateChanged, signOut
  } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import {
    getFirestore, doc, getDoc, setDoc, updateDoc
  } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDGdIsemWvuUTe7Df6iOK7suxMRC8G0vNg",
    authDomain: "intel-pay-ltd.firebaseapp.com",
    projectId: "intel-pay-ltd",
    storageBucket: "intel-pay-ltd.appspot.com",
    messagingSenderId: "779411397815",
    appId: "1:779411397815:web:7b6d9f34572d13a833c132"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  onAuthStateChanged(auth, async (user) => {
    if (!user) return location.href = "login.html";

    const uid = user.uid;
    const userRef = doc(db, "users", uid);
    const userSnap = await getDoc(userRef);

    if (!userSnap.exists()) return alert("User not found");

    const userData = userSnap.data();
    let earnings = userData.earnings || 0;
    const joined = userData.joinDate || new Date().toISOString();
    const hasPaid = userData.hasPaid === true;

    // Auto-increase 4% earnings every login
    if (hasPaid && earnings < 5500) {
      earnings = +(earnings * 1.04).toFixed(2);
      if (earnings > 5500) earnings = 5500;
      await updateDoc(userRef, { earnings });
    }

    document.getElementById("earnings").innerText = `₦${earnings.toFixed(2)}`;
    document.getElementById("statusText").innerText = hasPaid
      ? "You are an active investor. Earnings will grow daily!"
      : "Activate your account by paying ₦5500 to start earning.";
  });

  function logout() {
    signOut(auth).then(() => location.href = "login.html");
  }
</script>
</body>
</html>